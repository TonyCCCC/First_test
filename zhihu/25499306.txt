最近几天，一款魔性的小游戏在微博上刷屏了，各大平台的主播也纷纷如感染病毒一样直播自己怎么玩这个游戏（被游戏玩）。
这个游戏叫做《不要停！八分音符酱♪》。它是一款来自岛国的恶搞游戏，主角是一只可爱的小生物 — 八分音符酱，玩家通过对它喊话来控制其前进和跳跃。
因为操作方式太奇葩，所以玩游戏的人本身似乎会比游戏更好玩……
不过这不是我今天重点。我们是编程教室啊，肯定不能像游戏主播一样打个游戏卖个萌就完啦！
所以，我就用了大约 100 行 Python 代码，自己实现了一个。而且，还配了个超霸气的主角：海中霸主皮皮虾！
先上效果（优化后的版本）：
              
              
                
魔性声控游戏 - 暴走皮皮虾 - 腾讯视频
                
https://v.qq.com/x/page/z0380ogn3e7.html
              
            
            
最初的仿制版本用了大约100行 Python 代码，花了半天时间。后来又花一天时间，根据自己的恶趣味，加了点更魔性的功能。另外加了个联机的排行榜。
执行文件和代码都上传了，不用安装 Python 也可以玩。具体细节可以对照源码看，代码不长。
这里简单说下实现的核心思路，主要用到两个模块：
cocos2d-python
这个之前的贪吃蛇大作战 Python 版就用到。参见 
爆款游戏《贪吃蛇大作战》的 Python 实现 - 知乎专栏
。负责游戏的主循环、图像渲染、事件响应等。
pyaudio
基于开源声音库 PortAudio 的 Python 模块。靠它实现这个游戏的核心玩法：声控。
有了这两样东西，其他就没什么特别的了。如果你用 cocos2d 开发过小游戏，剩下的就是一些常规工作。通过几个代码片段粗略地说下：
定义角色，添加在场景上
# 定义 sprite


class
 
PPX
(
cocos
.
sprite
.
Sprite
):

    
def
 
__init__
(
self
):

        
super
(
PPX
,
 
self
)
.
__init__
(
'ppx.png'
)

        
...
 
# 略


# 创建并添加


self
.
ppx
 
=
 
PPX
()


self
.
add
(
self
.
ppx
)


给角色增加重力的效果
def
 
update
(
self
,
 
dt
):

    
self
.
speed
 
+=
 
10
 
*
 
dt

    
self
.
y
 
-=
 
self
.
speed

    
if
 
self
.
y
 
<
 
-
80
:

        
self
.
reset
()


获取麦克风的声音
# 初始化


pa
 
=
 
PyAudio
()


SAMPLING_RATE
 
=
 
int
(
pa
.
get_device_info_by_index
(
0
)[
'defaultSampleRate'
])


self
.
stream
 
=
 
pa
.
open
(
format
=
paInt16
,
 
channels
=
1
,
 
rate
=
SAMPLING_RATE
,
 
input
=
True
,
 
frames_per_buffer
=
self
.
NUM_SAMPLES
)


# 每帧中获取音量


string_audio_data
 
=
 
self
.
stream
.
read
(
self
.
NUM_SAMPLES
)


k
 
=
 
max
(
struct
.
unpack
(
'1000h'
,
 
string_audio_data
))


通过音量判断行走和跳跃
if
 
k
 
>
 
3000
:

    
self
.
floor
.
x
 
-=
 
min
((
k
 
/
 
20.0
),
 
150
)
 
*
 
dt


if
 
k
 
>
 
8000
:

    
self
.
ppx
.
jump
((
k
 
-
 
8000
)
 
/
 
1000.0
)


目前只是通过试验随意设置了下参数，不能保证在每台电脑上的效果。
这里，地面上的每个块是放在一个整体的容器里，皮皮虾的“行走”，其实是通过地面整体向后退来实现的。
简单的碰撞检测
def
 
collide
(
self
):

    
px
 
=
 
self
.
ppx
.
x
 
-
 
self
.
floor
.
x

    
for
 
b
 
in
 
self
.
floor
.
get_children
():

        
if
 
b
.
x
 
<=
 
px
 
+
 
self
.
ppx
.
width
 
*
 
0.8
 
and
 
px
 
+
 
self
.
ppx
.
width
 
*
 
0.2
 
<=
 
b
.
x
 
+
 
b
.
width
:

            
if
 
self
.
ppx
.
y
 
<
 
b
.
height
:

                
self
.
ppx
.
land
(
b
.
height
)

                
break


如果你现在对上面的代码还一脸懵逼，没关系，赶紧去看一看我们公众号里超好懂的入门教程。我们之后也还会对游戏开发、爬虫、数据分析等方面做进一步的介绍。
公众号（Crossin的编程教室）里回复 
皮皮虾
，获取游戏程序和源代码。
其他文章及回答：
学习编程的过程中可能会走哪些弯路，有哪些经验可以参考？
你是如何自学 Python 的？
数据分析：当赵雷唱民谣时他唱些什么？
我去扒了杜蕾斯的微博
一行代码扫出“敬业福”
今天，你抢到票了吗？
Crossin的编程教室
微信公众号ID：crossincode
网站：
crossincode.com
